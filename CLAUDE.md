# AIアシスタント プロジェクトガイド

このプロジェクトで作業する際のガイダンスを提供します。
下記のAI行動原則は常に遵守してください。

## AI行動原則

1. **応答時**
   - 応答時には、必ずこのAI行動原則を画面出力してから対応する

2. **開発方針**
   - テストを作成しながら進める。
   - テストカバレッジは90％以上を維持する。
   - テスト成功率は100％を維持する。
   - スペック駆動開発システムを遵守して進める。

## スペック駆動開発システム

あなたはスペック駆動開発を行うAIエージェントです。要件→設計→タスク→実装の構造化されたプロセスでアプリケーションを構築します。

### プロジェクト構造

```
project-root/
├── spec/
│   ├── requirements.md      # 全体要件仕様書
│   ├── design.md           # 全体設計仕様書
│   ├── tasks.md            # 全体タスク管理
│   ├── architecture.md     # システムアーキテクチャ
│   ├── authentication/     # 認証機能
│   │   ├── requirements.md
│   │   ├── design.md
│   │   └── tasks.md
│   ├── user-management/     # ユーザー管理機能
│   │   ├── requirements.md
│   │   ├── design.md
│   │   └── tasks.md
│   └── [feature-name]/     # その他の機能
│       ├── requirements.md
│       ├── design.md
│       └── tasks.md
└── [プロジェクト固有のファイル・フォルダ構造]
```

**注意**: APIが必要なプロジェクトの場合は、各機能フォルダに `api-spec.md` を追加してください。

### スペック駆動開発フロー

#### 1. 要件定義フェーズ (Requirements)
ユーザーの要求を受け取ったら、以下の手順で要件を定義：

1. **全体要件の整理**
   - `spec/requirements.md` で全体要件を定義
   - 機能一覧と優先度を明確化

2. **機能別要件の作成**
   - `spec/[feature-name]/requirements.md` で機能要件を詳細化
   - EARS表記法でユーザーストーリーを記述

#### 2. 設計フェーズ (Design)
要件が確定したら、以下の設計ドキュメントを作成：

1. **全体設計**
   - `spec/design.md` でシステム全体設計
   - `spec/architecture.md` でアーキテクチャ詳細

2. **機能別設計**
   - `spec/[feature-name]/design.md` で機能設計
   - 必要に応じて `spec/[feature-name]/api-spec.md` でAPI仕様

#### 3. タスク分解フェーズ (Tasks)
設計が完了したら、実装タスクを分解：

1. **全体タスク管理**
   - `spec/tasks.md` で全体スケジュール管理

2. **機能別タスク**
   - `spec/[feature-name]/tasks.md` で機能別実装タスク
   - Phase別に構造化（基盤→コア→品質→運用）

#### 4. 実装フェーズ (Implementation)
タスクに従って実装を進行：

1. **実装の進行**
   - `spec/[feature-name]/tasks.md` のタスクに従って実装
   - 仕様書との整合性を保持しながら開発

### 機能要件テンプレート

```markdown
# [機能名] 要件仕様書

**作成日**: {DATE}
**最終更新**: {DATE}
**ステータス**: Draft

## 機能概要
[機能の目的と概要]

## ユーザーストーリー
### US-[ID]: [ストーリー名]
**As a** [ユーザー役割]
**I want** [望む機能]
**So that** [目的・価値]

**受け入れ基準:**
- GIVEN [前提条件]
- WHEN [実行条件]
- THEN [期待結果]

## 機能仕様
- [基本機能1]
- [基本機能2]
- [基本機能3]

## 非機能要件
- **パフォーマンス**: [要件]
- **セキュリティ**: [要件]
- **可用性**: [要件]

## 依存関係
- **前提機能**: [依存する他機能]
- **影響範囲**: [影響を与える他機能]
```

### 機能設計テンプレート

```markdown
# [機能名] 設計仕様書

**作成日**: {DATE}
**関連要件**: [requirements.md](./requirements.md)

## 設計概要
[実装方針と設計思想]

## データモデル
```typescript
interface [ModelName] {
  id: string;
  // フィールド定義
}
```

### インターフェース設計
[UIコンポーネント、関数、クラス等の設計]

### API設計（必要に応じて）
| Method | Path | Description | Request | Response |
|--------|------|-------------|---------|----------|
| GET | /api/[resource] | [説明] | [型] | [型] |
| POST | /api/[resource] | [説明] | [型] | [型] |

### 実装方針
- [技術選択]
- [実装パターン]
- [エラーハンドリング]


### 機能タスクテンプレート

```markdown
# [機能名] 実装タスク

**関連仕様**: [requirements.md](./requirements.md) | [design.md](./design.md)

## Phase 1: 基盤構築
- [ ] データベース設計
- [ ] API基盤実装
- [ ] 認証・認可設定

## Phase 2: コア機能実装
- [ ] [機能1] 実装
- [ ] [機能2] 実装
- [ ] [機能3] 実装

## Phase 3: 品質保証
- [ ] ユニットテスト
- [ ] 統合テスト
- [ ] E2Eテスト

## Phase 4: 運用準備
- [ ] 監視・ログ設定
- [ ] セキュリティテスト
- [ ] デプロイメント準備
```

### 実行指針

#### 新規プロジェクト開始時
```markdown
1. **プロジェクト概要をお聞かせください**
   - アプリケーション概要
   - 主要機能リスト
   - 技術的要望

2. **機能の洗い出し**
   - 必要機能の特定
   - 機能別フォルダ作成
   - 機能間依存関係の整理

3. **スペック駆動開発の開始**
   - 全体要件書作成
   - 機能別要件書作成
   - 設計書作成
   - タスク分解
```

#### 機能追加時
```markdown
1. **新機能の要件確認**
   - 機能目的と概要
   - 既存機能との関係

2. **機能フォルダ作成**
   - spec/[new-feature]/ 作成
   - 要件・設計・タスクファイル生成

3. **仕様書作成**
   - requirements.md 作成
   - design.md 作成
   - tasks.md 作成
   - api-spec.md 作成（APIが必要な場合）
```

#### 実装進行時
```markdown
1. **タスク進捗の確認**
   - 現在の実装状況
   - 完了タスクの確認

2. **仕様書との整合性確認**
   - 実装内容が仕様書と一致しているか
   - 必要に応じて仕様書を更新

3. **次のタスクの実行**
   - 優先度に従ったタスク実行
   - 依存関係を考慮した順序
```

---

## プロジェクト概要

これは**Ultimate Mac Developer Environment Setup Script** - 新しいMacに完全な開発環境を自動的にセットアップする包括的なbashスクリプトです。

## 主要情報

- **メインスクリプト**: `mac-setup-modular.sh` (約600行)
- **目的**: macOSでの開発ツール、アプリケーション、設定のモジュラー式セットアップ
- **対応環境**: macOS Big Sur (11.0)以降、Apple SiliconとIntelアーキテクチャの両方に対応
- **特徴**: 基本/カスタム/フルの3つのセットアップモードを提供

## コマンド

### スクリプトの実行

```bash
# スクリプトに実行権限を付与
chmod +x mac-setup-modular.sh

# スクリプトを実行
./mac-setup-modular.sh
```

### 変更のテスト

これはシステムセットアップスクリプトなので、テストは慎重に行う必要があります：
- 可能な限りテスト用のMacまたはVMを使用
- 他の部分をコメントアウトして個別の関数をテスト
- 実行前に既存の設定を必ずバックアップ

## アーキテクチャと構造

スクリプトはモジュラー構造で、以下の主要な関数で構成されています：

1. **基本機能**:
   - `check_macos_version()`: macOSバージョンのチェック
   - `detect_architecture()`: Apple Silicon/Intelの検出
   - `install_xcode_cli()`: Xcode CLTのインストール
   - `install_homebrew()`: Homebrewのインストール

2. **インストール関数**:
   - `install_basic_tools()`: 基本ツール（全員必須）
   - `install_programming_languages()`: プログラミング言語（選択式）
   - `install_databases()`: データベース（選択式）
   - `install_dev_tools()`: 開発ツール（選択式）
   - `install_modern_cli()`: モダンCLIツール（選択式）
   - `install_productivity_tools()`: 生産性ツール（選択式）

3. **設定関数**:
   - `setup_oh_my_zsh()`: Oh My Zshのセットアップ
   - `create_basic_config()`: 基本的な設定ファイルの作成
   - `generate_ssh_key()`: SSH鍵の生成

4. **メニューシステム**:
   - `show_menu()`: メインメニュー表示
   - `checkbox_menu()`: チェックボックス選択UI
   - `custom_setup()`: カスタムセットアップのサブメニュー

## 重要な考慮事項

- `set -e`によるエラーハンドリング - コマンドの失敗で実行が停止
- 既存の設定ファイルは`.backup`拡張子でバックアップされる
- GitHubメールアドレスと続行確認の対話的プロンプトが表示される
- アーキテクチャ検出でApple SiliconとIntel Macを異なる方法で処理
- カラー出力とプログレスインジケーターで実行中のフィードバックを提供

## 開発ガイドライン

- 可能な限り冪等性を維持 - スクリプトは複数回実行しても安全であるべき
- 既存の`print_error`関数を使用した一貫性のあるエラーハンドリングパターンを使用
- 出力メッセージには既存のカラースキームに従う
- 新しいツールを追加する前にbrewフォーミュラの利用可能性をテスト
- 設定ファイルは読みやすく、適切にコメントを付ける